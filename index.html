<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—æ¯åºåˆ—éªŒè¯å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        input[type="date"], input[type="text"] {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        input[type="text"] {
            letter-spacing: 5px;
            text-transform: uppercase;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        button {
            padding: 12px 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #0b7dda;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background-color: #e8f5e9;
            border-left: 5px solid #4CAF50;
        }
        .error {
            background-color: #ffebee;
            border-left: 5px solid #f44336;
        }
        .sequence-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 10px;
            margin: 20px 0;
        }
        .details {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
        }
        .correct-sequence {
            color: #4CAF50;
        }
        .incorrect-sequence {
            color: #f44336;
        }
        .actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .history {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .history-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .history-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å­—æ¯åºåˆ—éªŒè¯å™¨</h1>
        <p>è¾“å…¥æ—¥æœŸå’ŒçŒœæµ‹çš„å­—æ¯åºåˆ—ï¼ŒéªŒè¯æ˜¯å¦æ­£ç¡®</p>
        
        <div class="input-section">
            <input type="date" id="dateInput" value="2025-12-30">
            <input type="text" id="sequenceInput" placeholder="è¾“å…¥4ä¸ªå­—æ¯ (å¦‚: ACBK)" maxlength="4">
            
            <div class="actions">
                <button onclick="verifySequence()">âœ… éªŒè¯åºåˆ—</button>
                <button onclick="loadFromGenerator()" style="background-color: #4CAF50;">
                    ğŸ“¥ åŠ è½½ç”Ÿæˆå™¨çš„åºåˆ—
                </button>
                <button onclick="openGenerator()" style="background-color: #9C27B0;">
                    ğŸ”„ è¿”å›ç”Ÿæˆå™¨
                </button>
            </div>
        </div>
        
        <div id="resultMessage" class="result">
            <h2 id="resultTitle"></h2>
            <div class="sequence-display" id="resultSequence"></div>
            
            <div class="details">
                <p><strong>éªŒè¯æ—¥æœŸ:</strong> <span id="verifiedDate"></span></p>
                <p><strong>è®¡ç®—å‡ºçš„æ­£ç¡®åºåˆ—:</strong> <span id="correctSequence"></span></p>
                <p><strong>æ‚¨çš„è¾“å…¥:</strong> <span id="userInput"></span></p>
                <p><strong>éªŒè¯ç»“æœ:</strong> <span id="validationResult"></span></p>
            </div>
        </div>
        
        <div class="history">
            <h3>ğŸ“ éªŒè¯å†å²</h3>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        // æ˜ å°„è¡¨ (ä¸ç”Ÿæˆå™¨ç›¸åŒ)
        const mapping = {
            '0': 'b', '1': 'a', '2': 'c', '3': 'k', 
            '4': 'g', '5': 'r', '6': 'o', '7': 'u', 
            '8': 'n', '9': 'd'
        };
        
        // æ’åˆ—æ–¹å¼ (0-9)
        const permutations = {
            '1': [1, 3, 4, 2], '2': [4, 2, 1, 3],
            '3': [2, 4, 3, 1], '4': [3, 1, 2, 4],
            '5': [2, 1, 4, 3], '6': [4, 3, 1, 2],
            '7': [1, 3, 2, 4], '8': [3, 4, 1, 2],
            '9': [1, 2, 4, 3], '0': [3, 4, 2, 1]
        };
        
        // æ’åˆ—åç§°
        const permNames = {
            '1': '1342', '2': '4213', '3': '2431',
            '4': '3124', '5': '2143', '6': '4312',
            '7': '1324', '8': '3412', '9': '1243',
            '0': '3421'
        };

        // éªŒè¯å†å²
        let verificationHistory = JSON.parse(localStorage.getItem('verificationHistory')) || [];

        function calculateSequence(dateInput) {
            const date = new Date(dateInput);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const ddmm = day + month;
            const dayDigit = day.charAt(1);
            
            const numbers = ddmm.split('');
            const originalLetters = numbers.map(num => mapping[num]);
            const perm = permutations[dayDigit];
            const finalLetters = perm.map(pos => originalLetters[pos - 1]);
            
            return {
                sequence: finalLetters.join('').toUpperCase(),
                dateStr: `${ddmm} (${day}/${month})`,
                dayDigit: dayDigit,
                permutation: permNames[dayDigit],
                original: originalLetters.join('')
            };
        }

        function verifySequence() {
            const dateInput = document.getElementById('dateInput').value;
            const userSequence = document.getElementById('sequenceInput').value.trim().toLowerCase();
            
            if (!dateInput || !userSequence) {
                alert('è¯·é€‰æ‹©æ—¥æœŸå¹¶è¾“å…¥4å­—æ¯åºåˆ—');
                return;
            }
            
            if (userSequence.length !== 4) {
                alert('è¯·è¾“å…¥4ä¸ªå­—æ¯');
                return;
            }
            
            const result = calculateSequence(dateInput);
            const isCorrect = userSequence === result.sequence.toLowerCase();
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.className = isCorrect ? 'result success' : 'result error';
            resultDiv.style.display = 'block';
            
            document.getElementById('resultTitle').textContent = 
                isCorrect ? 'âœ… éªŒè¯é€šè¿‡ï¼' : 'âŒ éªŒè¯å¤±è´¥';
            document.getElementById('resultSequence').textContent = 
                userSequence.toUpperCase();
            document.getElementById('resultSequence').className = 
                isCorrect ? 'sequence-display correct-sequence' : 'sequence-display incorrect-sequence';
            document.getElementById('verifiedDate').textContent = result.dateStr;
            document.getElementById('correctSequence').textContent = result.sequence;
            document.getElementById('userInput').textContent = userSequence.toUpperCase();
            document.getElementById('validationResult').textContent = 
                isCorrect ? 'æ­£ç¡® âœ“' : 'é”™è¯¯ âœ—';
            
            // ä¿å­˜åˆ°å†å²
            const historyItem = {
                date: dateInput,
                userInput: userSequence.toUpperCase(),
                correctSequence: result.sequence,
                isCorrect: isCorrect,
                timestamp: new Date().toLocaleString()
            };
            
            verificationHistory.unshift(historyItem);
            if (verificationHistory.length > 10) verificationHistory = verificationHistory.slice(0, 10);
            localStorage.setItem('verificationHistory', JSON.stringify(verificationHistory));
            
            updateHistoryDisplay();
        }

        function loadFromGenerator() {
            const lastSequence = localStorage.getItem('lastGeneratedSequence');
            const lastDate = localStorage.getItem('lastGeneratedDate');
            
            if (lastSequence && lastDate) {
                document.getElementById('dateInput').value = lastDate;
                document.getElementById('sequenceInput').value = lastSequence;
                alert(`å·²åŠ è½½ä¸Šæ¬¡ç”Ÿæˆçš„åºåˆ—: ${lastSequence}`);
            } else {
                alert('æœªæ‰¾åˆ°ç”Ÿæˆå™¨çš„å†å²è®°å½•');
            }
        }

        function openGenerator() {
            window.open('generator.html', '_blank');
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (verificationHistory.length === 0) {
                historyList.innerHTML = '<p>æš‚æ— éªŒè¯è®°å½•</p>';
                return;
            }
            
            verificationHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <strong>${item.timestamp}</strong><br>
                    æ—¥æœŸ: ${item.date} | è¾“å…¥: <span style="color: ${item.isCorrect ? '#4CAF50' : '#f44336'}">${item.userInput}</span>
                    | æ­£ç¡®: ${item.correctSequence} | ${item.isCorrect ? 'âœ“' : 'âœ—'}
                `;
                historyList.appendChild(div);
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°å†å²è®°å½•
        window.onload = updateHistoryDisplay;
    </script>
</body>
</html>
